<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compra | Tienda Peñíscola</title>
    <style>
        /* Variables del Sistema de Diseño */
        :root {
            /* Base Neutra (80% del diseño) */
            --neutral-white: #FEFEFE;
            --neutral-cream: #FDFBF7;
            --neutral-gray-50: #F8F6F0;
            --neutral-gray-200: #E5E7EB;
            --neutral-gray-400: #9CA3AF;
            --neutral-gray-600: #6B7280;
            --neutral-gray-800: #2C2C2C;
            --neutral-black: #1A1A1A;
            
            /* Colores de Énfasis (20% - Solo uso justificado) */
            --accent-orange: #FF6B35;
            --accent-red: #E30613;
            --accent-blue: #0066CC;
            --accent-yellow: #FFD100;
            --accent-green: #9CAF88;
            
            /* Tipografía */
            --font-primary: 'Futura', 'Avenir Next', 'Helvetica Neue', sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', 'Courier New', monospace;
            
            /* Spacing sistemático 8px */
            --space-1: 0.5rem;   /* 8px */
            --space-2: 1rem;     /* 16px */
            --space-3: 1.5rem;   /* 24px */
            --space-4: 2rem;     /* 32px */
            --space-6: 3rem;     /* 48px */
            --space-8: 4rem;     /* 64px */
            --space-12: 6rem;    /* 96px */
            --space-16: 8rem;    /* 128px */
            
            /* Tamaños fluidos */
            --text-sm: clamp(0.875rem, 1vw, 1rem);
            --text-base: clamp(1rem, 1.2vw, 1.125rem);
            --text-lg: clamp(1.125rem, 1.5vw, 1.25rem);
            --text-xl: clamp(1.25rem, 2vw, 1.5rem);
            --text-2xl: clamp(1.5rem, 3vw, 2rem);
            --text-3xl: clamp(2rem, 4vw, 3rem);
        }
        
        /* Reset y base */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-primary);
            background: var(--neutral-white);
            color: var(--neutral-gray-800);
            line-height: 1.7;
            font-size: var(--text-base);
            font-weight: 300;
            letter-spacing: 0.5px;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        /* Layout principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }
        
        /* Header simplificado */
        .header {
            background: var(--neutral-white);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            padding: var(--space-3) 0;
            margin-bottom: var(--space-8);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-text {
            font-family: var(--font-primary);
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--neutral-black);
            letter-spacing: 2px;
            text-transform: uppercase;
            text-decoration: none;
        }
        
        .back-link {
            color: var(--accent-orange);
            text-decoration: none;
            font-weight: 400;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: color 0.3s ease;
        }
        
        .back-link:hover {
            color: var(--neutral-black);
        }
        
        /* Carrito layout */
        .carrito-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-8);
            margin-bottom: var(--space-12);
        }
        
        .carrito-items {
            background: var(--neutral-white);
        }
        
        .carrito-title {
            font-size: var(--text-2xl);
            font-weight: 300;
            color: var(--neutral-black);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: var(--space-6);
        }
        
        .carrito-vacio {
            text-align: center;
            padding: var(--space-8);
            color: var(--neutral-gray-400);
            font-size: var(--text-lg);
        }
        
        .item-carrito {
            display: grid;
            grid-template-columns: 100px 1fr auto auto auto;
            gap: var(--space-4);
            align-items: center;
            padding: var(--space-4);
            border-bottom: 1px solid var(--neutral-gray-200);
            transition: background 0.3s ease;
        }
        
        .item-carrito:hover {
            background: var(--neutral-gray-50);
        }
        
        .item-imagen {
            width: 80px;
            height: 80px;
            background: var(--neutral-gray-50);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-gray-400);
            font-size: var(--text-sm);
        }
        
        .item-info h3 {
            font-size: var(--text-lg);
            font-weight: 400;
            color: var(--neutral-black);
            margin-bottom: var(--space-1);
            letter-spacing: 1px;
        }
        
        .item-info p {
            color: var(--neutral-gray-600);
            font-size: var(--text-sm);
        }
        
        .item-precio {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--accent-orange);
        }
        
        .cantidad-controls {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .cantidad-btn {
            background: var(--neutral-gray-200);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .cantidad-btn:hover {
            background: var(--accent-orange);
            color: var(--neutral-white);
        }
        
        .cantidad-input {
            width: 60px;
            text-align: center;
            border: 1px solid var(--neutral-gray-200);
            padding: var(--space-1);
            border-radius: 4px;
            font-family: var(--font-mono);
        }
        
        .eliminar-btn {
            background: var(--accent-red);
            color: var(--neutral-white);
            border: none;
            padding: var(--space-1) var(--space-2);
            border-radius: 4px;
            cursor: pointer;
            font-size: var(--text-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: background 0.3s ease;
        }
        
        .eliminar-btn:hover {
            background: var(--neutral-black);
        }
        
        /* Resumen del carrito */
        .carrito-resumen {
            background: var(--neutral-gray-50);
            padding: var(--space-6);
            border-radius: 8px;
            height: fit-content;
            position: sticky;
            top: var(--space-4);
        }
        
        .resumen-title {
            font-size: var(--text-xl);
            font-weight: 400;
            color: var(--neutral-black);
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: var(--space-4);
        }
        
        .resumen-linea {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-2);
            padding: var(--space-1) 0;
        }
        
        .resumen-linea.total {
            border-top: 2px solid var(--neutral-gray-200);
            margin-top: var(--space-4);
            padding-top: var(--space-3);
            font-weight: 600;
            font-size: var(--text-lg);
            color: var(--neutral-black);
        }
        
        .checkout-btn {
            width: 100%;
            background: var(--accent-orange);
            color: var(--neutral-white);
            border: none;
            padding: var(--space-3) var(--space-4);
            font-family: var(--font-primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: var(--space-4);
            border-radius: 4px;
        }
        
        .checkout-btn:hover {
            background: var(--neutral-black);
        }
        
        .checkout-btn:disabled {
            background: var(--neutral-gray-400);
            cursor: not-allowed;
        }
        
        .continuar-comprando {
            display: block;
            text-align: center;
            color: var(--neutral-gray-600);
            text-decoration: none;
            margin-top: var(--space-3);
            font-size: var(--text-sm);
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: color 0.3s ease;
        }
        
        .continuar-comprando:hover {
            color: var(--accent-orange);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .carrito-container {
                grid-template-columns: 1fr;
                gap: var(--space-6);
            }
            
            .item-carrito {
                grid-template-columns: 80px 1fr;
                gap: var(--space-3);
            }
            
            .item-precio,
            .cantidad-controls,
            .eliminar-btn {
                grid-column: 2;
                margin-top: var(--space-2);
            }
            
            .cantidad-controls {
                justify-self: start;
            }
            
            .eliminar-btn {
                justify-self: end;
            }
        }
        
        /* Estados de focus accesibles */
        a:focus,
        button:focus,
        input:focus {
            outline: 2px solid var(--accent-orange);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo-text">Tienda Peñíscola</a>
                <a href="index.html" class="back-link">← Volver a la tienda</a>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="carrito-container">
            <div class="carrito-items">
                <h1 class="carrito-title">Tu Carrito</h1>
                <div id="carritoContent">
                    <div class="carrito-vacio">
                        <p>Tu carrito está vacío</p>
                        <a href="index.html" class="continuar-comprando">Continuar comprando</a>
                    </div>
                </div>
            </div>
            
            <div class="carrito-resumen">
                <h2 class="resumen-title">Resumen</h2>
                <div id="resumenContent">
                    <div class="resumen-linea">
                        <span>Subtotal:</span>
                        <span id="subtotal">€0.00</span>
                    </div>
                    <div class="resumen-linea">
                        <span>Envío:</span>
                        <span id="envio">€5.00</span>
                    </div>
                    <div class="resumen-linea">
                        <span>IVA (21%):</span>
                        <span id="iva">€0.00</span>
                    </div>
                    <div class="resumen-linea total">
                        <span>Total:</span>
                        <span id="total">€0.00</span>
                    </div>
                </div>
                
                <button class="checkout-btn" id="checkoutBtn" disabled>
                    Proceder al Pago
                </button>
                <a href="index.html" class="continuar-comprando">Continuar comprando</a>
            </div>
        </div>
    </main>

    <script>
        // Obtener carrito del localStorage
        function obtenerCarrito() {
            const carritoGuardado = localStorage.getItem('carritoTienda');
            return carritoGuardado ? JSON.parse(carritoGuardado) : [];
        }

        // Guardar carrito en localStorage
        function guardarCarrito(carrito) {
            localStorage.setItem('carritoTienda', JSON.stringify(carrito));
        }

        // Renderizar items del carrito
        function renderCarrito() {
            const carrito = obtenerCarrito();
            const carritoContent = document.getElementById('carritoContent');
            
            if (carrito.length === 0) {
                carritoContent.innerHTML = `
                    <div class="carrito-vacio">
                        <p>Tu carrito está vacío</p>
                        <a href="index.html" class="continuar-comprando">Continuar comprando</a>
                    </div>
                `;
                return;
            }
            
            carritoContent.innerHTML = carrito.map(item => `
                <div class="item-carrito">
                    <div class="item-imagen">
                        Img ${item.id}
                    </div>
                    <div class="item-info">
                        <h3>${item.nombre}</h3>
                        <p>${item.descripcion}</p>
                    </div>
                    <div class="item-precio">
                        €${item.precio.toFixed(2)}
                    </div>
                    <div class="cantidad-controls">
                        <button class="cantidad-btn" onclick="cambiarCantidad(${item.id}, -1)">-</button>
                        <input type="number" class="cantidad-input" value="${item.cantidad}" 
                               onchange="actualizarCantidad(${item.id}, this.value)" min="1">
                        <button class="cantidad-btn" onclick="cambiarCantidad(${item.id}, 1)">+</button>
                    </div>
                    <button class="eliminar-btn" onclick="eliminarItem(${item.id})">
                        Eliminar
                    </button>
                </div>
            `).join('');
            
            actualizarResumen();
        }

        // Cambiar cantidad de un producto
        function cambiarCantidad(productId, cambio) {
            let carrito = obtenerCarrito();
            const item = carrito.find(item => item.id === productId);
            
            if (item) {
                item.cantidad += cambio;
                if (item.cantidad <= 0) {
                    carrito = carrito.filter(item => item.id !== productId);
                }
                guardarCarrito(carrito);
                renderCarrito();
            }
        }

        // Actualizar cantidad directamente
        function actualizarCantidad(productId, nuevaCantidad) {
            const cantidad = parseInt(nuevaCantidad);
            if (cantidad <= 0) {
                eliminarItem(productId);
                return;
            }
            
            let carrito = obtenerCarrito();
            const item = carrito.find(item => item.id === productId);
            
            if (item) {
                item.cantidad = cantidad;
                guardarCarrito(carrito);
                renderCarrito();
            }
        }

        // Eliminar item del carrito
        function eliminarItem(productId) {
            let carrito = obtenerCarrito();
            carrito = carrito.filter(item => item.id !== productId);
            guardarCarrito(carrito);
            renderCarrito();
        }

        // Actualizar resumen de compra
        function actualizarResumen() {
            const carrito = obtenerCarrito();
            const subtotal = carrito.reduce((total, item) => total + (item.precio * item.cantidad), 0);
            const envio = carrito.length > 0 ? 5.00 : 0;
            const iva = subtotal * 0.21;
            const total = subtotal + envio + iva;
            
            document.getElementById('subtotal').textContent = `€${subtotal.toFixed(2)}`;
            document.getElementById('envio').textContent = `€${envio.toFixed(2)}`;
            document.getElementById('iva').textContent = `€${iva.toFixed(2)}`;
            document.getElementById('total').textContent = `€${total.toFixed(2)}`;
            
            const checkoutBtn = document.getElementById('checkoutBtn');
            checkoutBtn.disabled = carrito.length === 0;
        }

        // Proceder al checkout
        function procederAlPago() {
            const carrito = obtenerCarrito();
            if (carrito.length === 0) return;
            
            // Simular proceso de pago
            alert('Funcionalidad de pago en desarrollo. ¡Gracias por tu interés!');
            
            // En un caso real, aquí se integraría con Stripe, PayPal, etc.
            // Por ahora, limpiar el carrito
            // localStorage.removeItem('carritoTienda');
            // window.location.href = 'confirmacion.html';
        }

        // Escuchar cambios en el localStorage para sincronizar pestañas
        window.addEventListener('storage', function(e) {
            if (e.key === 'carritoTienda') {
                renderCarrito();
            }
        });

        // Event listener para el botón de checkout
        document.getElementById('checkoutBtn').addEventListener('click', procederAlPago);

        // Inicializar la página
        document.addEventListener('DOMContentLoaded', function() {
            renderCarrito();
        });

        // Actualizar el carrito cada vez que se hace foco en la ventana
        window.addEventListener('focus', function() {
            renderCarrito();
        });
    </script>
</body>
</html>